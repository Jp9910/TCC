\chapter{Características da arquitetura}\label{chapter-caracteristicas}

\chapterprecis{Este capítulo aprensenta as características e as vantagens da arquitetura de microsserviços, assim como os riscos, desafios e desvantagens que as acompanham.}\index{sinopse de capítulo}

% \section{Propriedades dos microsserviços}

Em geral não existe uma definição formal do que a arquitetura de microsserviços tem ou não tem, entretanto as características aqui apresentadas são características comuns observadas em arquiteturas que se encaixam como microsserviços. Assim sendo, nem todas as arquiteturas de microsserviços terão essas características, apesar de ser esperado que a maioria delas estejam presentes \cite{martin-fowler-microservices}.

\section{Sistema distribuído}
A arquitetura de microsserviços forma naturalmente um sistema altamente distribuido, o que implica em alguns comportamentos e características. Uma delas é que qualquer chamada a um serviço está sujeita a falhas, e portanto microsserviços devem ser projetados para serem resilientes, isso é, tolerantes a falhas e ter um tempo de recuperação razoável quando algum problema acontecer \cite{Familiar2015}.

Um benefício proveniente dessa distribuição é que microsserviços podem ser usados em soluções e cenários de uso diferentes, contudo para tanto devem ser escaláveis, responsivos e configuráveis, para assim alcançar um bom desempenho independente do cenário de uso. Outro benefício dessa distribuição é a autonomia e o isolamento, o que significa que microsserviços são unidades auto-contidas de funcionalidade, com dependências de outros serviços fracamente acopladas, então podem ser projetados, desenvolvidos, testados e implantados independentemente \cite{martin-fowler-microservices,Familiar2015}.

Um desafio advindo dessa distribuição é que a comunicação é complexa e falível. Geralmente ela depende de APIs e contratos de dados para definir como os microsserviços interagem, ou seja, os microsserviços são orientados-a-mensagens. A API define um conjunto de \emph{endpoints} acessíveis por rede, e o contrato de dados define a estrutura da mensagem que é enviada ou retornada \cite{Familiar2015}.

% \section{Vantagens}

\section{Flexibilidade na escolha de tecnologias}

Como mencionado anteriormente, cada microsserviço disponibiliza suas funcionalidades por meio de APIs e contratos de dados em uma rede. Usando esse meio, a comunicação independe da arquitetura que o microsserviço faz uso, o que possibilita que cada microsserviço possa escolher seu sistema operacional, linguagem e outras tecnologias. Além disso, eles podem ser desenvolvidos usando uma linguagem de programação e estrutura que melhor se adapte ao problema que ele é projetado para resolver. Embora essa flexibilidade seja algo positivo, usar muitas tecnologias diferentes aumenta a complexidade do sistema \cite{oracle_microservices, Familiar2015}.

\section{Alta velocidade de desenvolvimento}

Com um time responsável por cuidar do ciclo de desenvolvimento e sua automação, a velocidade com que microsserviços podem ser desenvolvidos é muito maior do que fazer o equivalente para uma solução monolítica \cite{Familiar2015}.

\section{Componentização - reusabilidade e combinabilidade}

Há muito tempo na indústria do \emph{software} deseja-se construir sistemas apenas juntando componentes, assim como se faz no mundo físico. Na computação, um componente é definido como uma unidade de \emph{software} que é atualizável e substituível independentemente. Apesar de ser muito comum o uso de pacotes e bibliotecas (padrão de projeto conhecido como \emph{sidecar}), que podem ser considerados componentes, há maneiras diferentes de se componentizar \emph{software} que são características dos microsserviços \cite{martin-fowler-microservices}.

Microsserviços podem utilizar pacotes e bibliotecas como componentes mas nesta arquitetura a maneira principal e mais eficiente para componentizar o \emph{software} é justamente ser dividido em serviços. Quando uma aplicação usa múltiplas bibliotecas como componentes em um único processo, uma mudança em qualquer desses componentes resulta na necessidade de reimplantar a aplicação toda. Se essa mesma aplicação é decomposta em múltiplos serviços, é provável que uma mudança nesse serviço só obrigaria a reimplantação do próprio serviço. Como os microsserviços são entidades independentes que provêem funcionalidades em um determinado escopo por meio de padrões de internet aberta, são reusáveis por natureza. Com essa componentização, fica mais fácil criar soluções para o usuário final combinando multiplos microsserviços \cite{martin-fowler-microservices,Familiar2015}.

Contudo, usar serviços dessa forma traz algumas desvantagens. A comunicação remota é muito mais complexa e cara, então o método de comunicação escolhido deve ser implementado de modo flexível. Além disso, realocar responsabilidades entre os componentes é mais difícil quando se trata de processos diferentes \cite{martin-fowler-microservices}.

\section{Flexibilidade no ambiente de execução}

A implantação de microsserviços é altamente dependente de sua automação. Para garantir flexibilidade de ambiente de execução, essa automação deve incluir configuração de cenários diferentes de uso, não apenas para produção, mas também para desenvolvimento e testagem, possibilitando que o microsserviço tenha o melhor desempenho em diversos cenários. Para tanto, é necessário o uso de ferramentas que configurem essa flexibilidade \cite{Familiar2015}.

\section{Versionável e substituível}

Com o controle completo dos cenários de implantação, é possível manter versões diferentes de um mesmo serviço rodando ao mesmo tempo, proporcionando retrocompatibilidade e fácil migração. Além disso, serviços podem ser atualizados ou mesmo substituidos sem ocasionar indisponibilidade do serviço \cite{Familiar2015}.

\section{Evolução}

Como explicado na \autoref{sessao-monolitos}, quanto maior e mais antigo o \emph{software}, mais difícil é de lhe dar manutenção. Porém, com componentes modularizados e organizados adequadamente, uma aplicação com arquitetura de microsserviços tende a crescer muito mais horizontalmente do que verticalmente, possibilitando que ela nunca chegue em um estado em que fica inviável dar manutenção. 

É possível decompor uma aplicação monolítica em uma arquitetura de microsserviços - tema de pesquisa muito recorrente na área de arquitetura de \emph{software} - mas esse processo não faz parte do escopo deste trabalho.

% Entretanto, é possível migrar de um sistema monolítico para a arquitetura de microsserviços aos poucos, um serviço por vez, identificando capacidades de negócio, implementando-as como um microsserviço, e integrando com uso de padrões de baixo acoplamento. Ao longo do tempo, mais e mais funcionalidades podem ser separadas e implementadas como microsserviço, até que o núcleo da aplicação monolítica se transforme em apenas um outro serviço, ou um microsserviço. \cite{Familiar2015}

\section{Complexidade e desafios}

O uso da arquitetura de microsserviços implica num grande aumento de complexidade não apenas na infraestrutura, mas também em muitas etapas do ciclo de desenvolvimento do \emph{software}, como no \emph{debug}, nos testes, e no monitoramento por exemplo. Além disso, o uso de diversas tecnologias geralmente traz problemas por inexperiência dos desenvolvedores. Dessa forma, existem muitos desafios no desenvolvimento de aplicações com arquitetura de microsserviços, que normalmente só conseguem ser compensados em aplicações mais complexas. Assim como em qualquer tipo de arquitetura, existem benefícios, riscos, desvantagens e desafios, e para determinar se adotá-la é uma escolha sábia é necessário entendê-los e aplicá-los ao contexto específico da aplicação e dos desenvolvedores \cite{top10-microservices-challenges,martin-fowler-microservice-tradeoffs}.

Um desafio considerado crítico para o bom funcionamento da aplicação é a definição adequada dos limites de cada microsserviço. Outros desafios são: complexidade de projeto, complexidade operacional, gerenciamento de redes, consistência de dados, comunicação, e manutenção. De acordo com \citeonline{CAOPLE}, os três grandes desafios do desenvolvimento de aplicações com arquitetura de microsserviços são (1) Como programar sistemas que consistem de um grande número de serviços executando em paralelo e distribuidos em um conjunto de máquinas, (2) Como reduzir a sobrecarga de comunicação causada pela execução de grandes números de pequenos serviços, e (3) Como sustentar a implantação flexível de serviços em uma rede para conseguir realizar o balanceamento de carga \cite{martin-fowler-monolith-first}.

% microservices impose a cost on productivity that can only be made up for in more complex systems. So if you can manage your system's complexity with a monolithic architecture then you shouldn't be using microservices. \cite{martin-fowler-microservice-tradeoffs}

% De acordo com \citeonline{design-monitoring-testing-waseem}, mais pesquisas são necessárias para lidar com a complexidade dos microsserviços no nível de projeto, de monitoramento, e de testes, desafios para qual não há soluções dedicadas.

%how to program systems that consists of a large number of services running in parallel and distributed over a cluster of computers;
%how to reduce the communication overhead caused by executing a large number of small services;
%how to support the flexible deployment of services to a network to achieve system load balance.

% citar curso alura


% Desvantagens dos microserviços:
% - Maior complexidade de desenvolvimento e infraestrutura;
% - Debug mais complexo;
% - Comunicação entre os serviços deve ser bem pensada;
% - Diversas tecnologias pode trazer problemas por inexperiência dos devs;
% - Monitoramento é crucial e mais complexo;
% - (Criar um microserviço pode ser complexo, e ter demais pode trazer problemas.).

% \subsection{Comunicação}

% - Comunicação entre os serviços deve ser bem pensada

% cross-platform compatibility issues and inconsistent call standards issues in the process of development and call microservices. \cite{ZUO2020102878}

% \subsection{[re]Organizaçao}

% Organizar o sistema e o time para sustentar uma arquitetura de microsserviços é um grande desafio. Como explica \citeonline{Familiar2015}: 
% \begin{citacao}
%     If you are part of a command-and-control organization using a waterfall software project management approach, you will struggle because you are not oriented to high-velocity product development. If you lack a DevOps culture and there is no collaboration between development and operations to automate the deployment pipeline, you will struggle. \cite{Familiar2015}
% \end{citacao}

% \subsection{Plataforma}
% Criar o ambiente de execução para microsserviços requer um grande investimento em infraestrutura dinâmica em \emph{data centers} dispersos para garantir maior disponibilidade. Se sua atual plataforma \emph{on-premises} não suporta automação, infraestrutura dinâmica, escalamento elástico e alta disponibilidade, deve-se considerar uma plataforma na nuvem. \cite{Familiar2015}. Mais sobre soluções na nuvem será discutido no \autoref{chapter-ferramentas}.

% % \subsection{Monitoramento}

% \subsection{Descoberta}

% Encontrar microsserviços em um ambiente distribuido pode ser feito de algumas maneiras diferentes. A informação pode ser armazenada diretamente no código, pode ser guardada e acessada em um arquivo, ou pode ser construido um microsserviço para encontrar outros microsserviços e disponibilizar suas localizações. Contudo, para prover detectabilidade como um serviço será necessário adquirir um produto de terceiros, integrar um projeto aberto, ou desenvolver sua própria solução. \cite{Familiar2015}
